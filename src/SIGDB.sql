DROP DATABASE IF EXISTS SIGDB;

CREATE DATABASE SIGDB;

USE SIGDB;

CREATE TABLE User(
    ID INTEGER NOT NULL PRIMARY KEY AUTO_INCREMENT,
    Username VARCHAR(50) NOT NULL UNIQUE,
    Password VARCHAR(50) NOT NULL,
    is_admin BOOLEAN default FALSE
);


CREATE TABLE SIG(
    ID INTEGER NOT NULL PRIMARY KEY AUTO_INCREMENT,
    Nom VARCHAR(50) NOT NULL,
    IDUser INTEGER NOT NULL,
    LienFond VARCHAR(255) DEFAULT NULL ,
    FOREIGN KEY (IDUser) REFERENCES User(ID) ON DELETE CASCADE
);


CREATE TABLE Couche(
    ID INTEGER NOT NULL PRIMARY KEY AUTO_INCREMENT,
    Nom VARCHAR(50) NOT NULL,
    IDSIG INTEGER NOT NULL,
    FOREIGN KEY (IDSIG) REFERENCES SIG(ID) ON DELETE CASCADE
);



CREATE TABLE Polygone (
    ID INTEGER NOT NULL PRIMARY KEY AUTO_INCREMENT,
    Nom VARCHAR(50) ,
    IDCouche INTEGER NOT NULL,
    FOREIGN KEY (IDCouche) REFERENCES Couche(ID) ON DELETE CASCADE,
    CONSTRAINT Nom_IDCouche_Unique UNIQUE (IDCouche, Nom)

);


CREATE TABLE Ligne (
    ID INTEGER NOT NULL PRIMARY KEY AUTO_INCREMENT,
    Nom VARCHAR(50) ,
    IDCouche INTEGER NOT NULL,
    FOREIGN KEY (IDCouche) REFERENCES Couche(ID) ON DELETE CASCADE,
    CONSTRAINT Nom_IDCouche_Unique UNIQUE (IDCouche, Nom)

);


CREATE TABLE PointNomer(
    ID INTEGER NOT NULL PRIMARY KEY AUTO_INCREMENT,
    Nom VARCHAR(50) ,
    IDCouche INTEGER NOT NULL,
    FOREIGN KEY (IDCouche) REFERENCES Couche(ID) ON DELETE CASCADE,
    CONSTRAINT Nom_IDCouche_Unique UNIQUE (IDCouche, Nom)

);

CREATE TABLE Point (
    ID INTEGER NOT NULL PRIMARY KEY AUTO_INCREMENT,
    X INTEGER NOT NULL,
    Y INTEGER NOT NULL,
    IDPolygone INTEGER DEFAULT NULL,
    IDLigne INTEGER DEFAULT NULL,
    IDPointNomer INTEGER DEFAULT NULL,
    FOREIGN KEY (IDPolygone) REFERENCES Polygone(ID) ON DELETE CASCADE,
    FOREIGN KEY (IDLigne) REFERENCES Ligne(ID) ON DELETE CASCADE,
    FOREIGN KEY (IDPointNomer) REFERENCES PointNomer(ID) ON DELETE CASCADE
);


CREATE TABLE Symbologie(
    ID INTEGER NOT NULL PRIMARY KEY AUTO_INCREMENT,
    Nom VARCHAR(50) ,
    IDCouche INTEGER NOT NULL UNIQUE ,
    FOREIGN KEY (IDCouche) REFERENCES Couche(ID) ON DELETE CASCADE
);


CREATE TABLE Couleur(
    ID INTEGER NOT NULL PRIMARY KEY AUTO_INCREMENT,
    Nom VARCHAR(50) ,
    Red INTEGER NOT NULL,
    Green INTEGER NOT NULL,
    Blue INTEGER NOT NULL,
    IDSymbologie INTEGER NOT NULL,
    FOREIGN KEY (IDSymbologie) REFERENCES Symbologie(ID) ON DELETE CASCADE
);




INSERT INTO User VALUES (NULL, "root", "root", true );
INSERT INTO User VALUES (NULL, "admin", "admin", true );
INSERT INTO User VALUES (NULL, "chems", "chems", false );


INSERT INTO SIG VALUES (NULL, "SIG1", 1, "photo");
INSERT INTO SIG VALUES (NULL, "SIG2", 2, "photo");
INSERT INTO SIG VALUES (NULL, "SIG3", 1, "photo");
INSERT INTO SIG VALUES (NULL, "SIG4", 3, "photo");

INSERT INTO Couche VALUES (NULL, "Points1", 1);
INSERT INTO Couche VALUES (NULL, "Lignes1", 1);
INSERT INTO Couche VALUES (NULL, "Points2", 2);
INSERT INTO Couche VALUES (NULL, "Polygone3", 3);

INSERT INTO Polygone VALUES (NULL, "Polygone1", 4);
INSERT INTO Polygone VALUES (NULL, "Polygone2", 4);

INSERT INTO Ligne VALUES (NULL, "ligne1", 2);
INSERT INTO Ligne VALUES (NULL, "ligne2", 2);


INSERT INTO PointNomer VALUES (NULL, "point1", 1);
INSERT INTO PointNomer VALUES (NULL, "point2", 1);
INSERT INTO PointNomer VALUES (NULL, "point3", 1);
INSERT INTO PointNomer VALUES (NULL, "point1", 3);
INSERT INTO PointNomer VALUES (NULL, "point2", 3);
INSERT INTO PointNomer VALUES (NULL, "point3", 3);

INSERT INTO Point VALUES (NULL, 1, 3, 1, null, null);
INSERT INTO Point VALUES (NULL, 2, 3, 1, null, null);
INSERT INTO Point VALUES (NULL, 3, 4, 1, null, null);
INSERT INTO Point VALUES (NULL, -1, 4, 1, null, null);
INSERT INTO Point VALUES (NULL, 1, 3, 2, null, null);
INSERT INTO Point VALUES (NULL, 2, 3, 2, null, null);
INSERT INTO Point VALUES (NULL, 3, 4, 2, null, null);


INSERT INTO Point VALUES (NULL, 3, 3, null, 1, null);
INSERT INTO Point VALUES (NULL, -4, 4, null, 1, null);
INSERT INTO Point VALUES (NULL, 15, 20, null, 1, null);
INSERT INTO Point VALUES (NULL, -3, 60, null, 1, null);
INSERT INTO Point VALUES (NULL, 20, 1, null, 2, null);
INSERT INTO Point VALUES (NULL, 22, 5, null, 2, null);
INSERT INTO Point VALUES (NULL, 15, 20, null, 2, null);
INSERT INTO Point VALUES (NULL, -3, 60, null, 2, null);
INSERT INTO Point VALUES (NULL, 20, 1, null, 2, null);
INSERT INTO Point VALUES (NULL, 22, 5, null, 2, null);

INSERT INTO Point VALUES (NULL, 8, 10, null, null, 1);
INSERT INTO Point VALUES (NULL, 9, 5, null, null, 2);
INSERT INTO Point VALUES (NULL, 10, 20, null, null, 3);
INSERT INTO Point VALUES (NULL, 11, 60, null, null, 4);
INSERT INTO Point VALUES (NULL, 12, 1, null, null, 5);
INSERT INTO Point VALUES (NULL, 13, 5, null, null, 6);


INSERT INTO Symbologie VALUES (NULL, "symbole1", 1);
INSERT INTO Symbologie VALUES (NULL, "symbole2", 2);
INSERT INTO Symbologie VALUES (NULL, "symbole3", 3);
INSERT INTO Symbologie VALUES (NULL, "symbole4", 4);

INSERT INTO Couleur VALUES (NULL, "color1", 120, 230, 15, 2);
INSERT INTO Couleur VALUES (NULL, "color2", 20, 20, 150, 3);
